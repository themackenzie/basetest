<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PRUEBA DE CARGA DE ESC√ÅNER QR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 50px;
            background-color: #f0f4f8;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            text-align: center;
        }
        h1 { color: #334155; margin-bottom: 20px; }
        .result-panel {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            font-weight: bold;
        }
        .fail { background-color: #fee2e2; color: #ef4444; border: 1px solid #f87171; }
        .success { background-color: #d1fae5; color: #059669; border: 1px solid #34d399; }
        .info { background-color: #dbeafe; color: #2563eb; border: 1px solid #60a5fa; }
        #reader-placeholder {
            width: 100%;
            min-height: 250px;
            border: 2px dashed #9ca3af;
            border-radius: 5px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ† Prueba de Carga de Librer√≠a QR üõ†</h1>
        <p class="info-text">
            Esta p√°gina verifica si la librer√≠a del esc√°ner (`html5-qrcode.minified.js`) se carga correctamente 
            y si tu navegador permite el acceso a la c√°mara.
        </p>

        <div id="status-message" class="result-panel info">
            Verificando la carga del script...
        </div>

        <div id="reader-placeholder">
            Zona de Previsualizaci√≥n del Esc√°ner
        </div>
    </div>

    <!-- Script de la librer√≠a QR - Mismo CDN que el Canvas principal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.minified.js"></script>

    <script>
        const statusMessage = document.getElementById('status-message');

        function updateStatus(statusType, message) {
            statusMessage.className = `result-panel ${statusType}`;
            statusMessage.innerHTML = message;
        }

        // Funci√≥n principal de prueba
        function runTest() {
            // 1. Verificar si la clase principal de la librer√≠a est√° definida
            if (typeof Html5QrcodeScanner === 'undefined') {
                updateStatus('fail', '‚ùå FALLO: La librer√≠a `html5-qrcode` no se carg√≥ correctamente. Esto podr√≠a ser el error `ERR_BLOCKED_BY_ORB` o un problema de red.');
                return;
            }

            updateStatus('success', '‚úÖ √âXITO: La librer√≠a `Html5QrcodeScanner` se carg√≥ correctamente.');

            // 2. Intentar inicializar el esc√°ner para verificar la API de la c√°mara
            const qrCodeRegionId = "reader-placeholder";
            let testScanner = null;

            try {
                // Crear una instancia de prueba
                testScanner = new Html5QrcodeScanner(
                    qrCodeRegionId, 
                    { 
                        fps: 1, 
                        qrbox: 50,
                        supportedScanTypes: [Html5QrcodeSupportedFormats.QR_CODE]
                    },
                    /* verbose= */ false
                );
                
                // Si la creaci√≥n es exitosa, se intenta renderizar.
                testScanner.render(
                    (decodedText, decodedResult) => { 
                        updateStatus('success', '‚úÖ C√ìDIGO ESCANEADO (PRUEBA): La c√°mara funciona y detect√≥ un QR.');
                        testScanner.pause();
                    }, 
                    (error) => {
                        // Falla silenciosa esperada cuando no hay QR, o si hay un error de c√°mara
                    }
                );
                
                // 3. Verificar el acceso a la c√°mara de manera expl√≠cita (para mejor diagn√≥stico)
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then(() => {
                            updateStatus('success', '‚úÖ √âXITO: La librer√≠a se carg√≥ y obtuvimos permiso para acceder a la c√°mara. El esc√°ner est√° intentando iniciarse a continuaci√≥n.');
                        })
                        .catch(err => {
                            updateStatus('fail', `‚ö†Ô∏è ALERTA: La librer√≠a carg√≥, pero el acceso a la c√°mara fall√≥: ${err.name}. Debes permitir el permiso de la c√°mara.`);
                        });
                } else {
                    updateStatus('info', '‚ÑπÔ∏è INFO: Tu navegador no soporta la API de c√°mara necesaria.');
                }

            } catch (e) {
                updateStatus('fail', `‚ùå FALLO DE INICIALIZACI√ìN: La librer√≠a carg√≥, pero hubo un error al iniciar el esc√°ner: ${e.message}`);
            }
        }

        // Inicia la prueba cuando la ventana haya cargado completamente
        window.onload = runTest;
    </script>
</body>
</html>
